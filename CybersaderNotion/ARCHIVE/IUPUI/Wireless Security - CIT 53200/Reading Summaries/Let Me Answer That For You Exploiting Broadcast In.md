# Let Me Answer That For You: Exploiting Broadcast
Information in Cellular Networks (2G - GSM & a bit of 3G)

# GSM Basics

- Radio & Cellular
    - spectrum is divided into uplink and downlink channels
    - GSM uses ARFCN
        - Absolute Radio Frequency Number
        - unique number that GSM can use
    - Environment is divided up into spaces of different frequencies
    - ARFCN divided up into 200kHz channels then divided up my TDMA
- BTS and BSC have the logical and functional part of communicating with devices
- GSM operates with TDMA, FDMA, and SDMA
    - Time and Freq division multiple access
    - Space division multiple access gives cellular concept
- GMSK (Gaussian Minimum Shift Keying)
    - variant of frequency shift keying
    - reduces required bandwidth
    - gaussian band pass optimizes for spacial use
- GSM core components not visible to an attacker
    - MSC
        - call switching to connect to different networks
    - Sort of like dbs - info about subscribers, encryption values, etc.
        - HLR
        - VLR
        - EIR
- GSM has logical channels - for signaling between phone and base station
    - Traffic channels & signaling channels
- VULNS:
    - most due to “in-band” signaling
    - managing channels are in the same bands as the traffic signals
    - mobile and transceiver station use the same bands for multiple functions
- Over-the-air encryption
    - a5/3 - unbroken publicly
    - a3/a8 - used during authentication right now
- GPRS - General Packet Radio Service (2.5G)
    - Packet control unit to Base station subsystem

## Cell Diags & Tools

- Nokia Netmonitor
- GSM analyzer
    - 100 - 10,000 dollars
    - restricted
- Osmocom-bb
    - write tools for mobile phone baseband
- GSMTAP
    - debug radio interface
    - see UM (air) interface
- AirProbe & Sniffing
    - capture radio spectrum
    - of a GSM ARFCN
    - purely passive
    - Kraken can decrypt A5/1 on TCH, with 1.6TB rainbow tables
    - Wireshark can parse the GSMTAP output and sniff the air interface

## GSM Weaknesses

- MS Power-on-Process
    - IMSI Capture & Detection
    - IMEI & Device Fingerprint
        - Country that allowed it to be used
        - pretty accurate
- Location Update Request
    - IMSI attach
        - hey im a phone - give me a connection
    - Phone is asked for equipment ID
    - Clone a BTS
        - use Osmocom-BB or a gsm-receiver tool
        - find the neighbor cell towers
            - find locality area code
- RACH & TMSI Paging Attacks
    - Random Access requests have finite resource, so just flood with RACH
    - use osmocom-bb
- all of these attacks can be DOS attacks
- Downgrade attacks & Jamming from 3G and 4G
    - LTE, UMTS, and GSM can be “jammed” to downgrade/force connections
    - Overpower the analog components of a radio with a stronger signal
    - Asian devices are often multi-band 1-10Watt radios and go against EMC
    - Protocols attempt to address “noise” or “sawtooth” jamming.
    - Effect can be simulated by disabling 4G/3G

## Pentesting or POC

- USE OpenBTS to simulate GSM environment
- GreedyBTS - USRP E100
- Use EMC & Shielding
- GreedyBTS
    - firmware image within USRP E100
    - SDR hacking

# Abstract

- Industry standards such as GSM (Global System for Mobile Communications) excludes active attacker scenarios
- Devices that are communicated with are assumed as trusted devices (contrary to basic security principles).
- Two new attacks are shown based on the paging procedure used in cellular networks
    - basic paging response attack
    - attack using custom loaded firmware for DOS
- For GSM, one can hijack calls, perform targeted DOS attacks, and DOS large regions within metro areas.

# Intro

- GSM has been assumed to be secure because the equipment used with GSM wasn’t publically available.  There wasn’t a lot of open source knowledge of the systems.
- As of 2013, research has gone into a direction that has brought radio tech stacks into the light.  In other words, they aren’t secure anymore because what made them secure was the low availability of the equipment.

## Basic architecture of radio part of cellular networks:

- 2 sides of the radio link (in cellular networks)
    - Base Station System (BSS)
        - Base Transceiver System (BTS)
        - Base Station Controller (BSC)
    - Modem or so-called “baseband” of a cellular phone
- *Traditionally, these were kept out of reach for any kind of malicious activity*

## **Why they became insecure:**

- Booming market for -
    - telecommunication equipment
    - cheap software defined radios
- leakage of some hardware specifications
- well-trained open source community

### **3 open source projects:**

- counterparts to closed radio stacks
- publicly available
- OpenBSC, OpenBTS, OsmocomBB

# (GSM) Global System for Mobile Communications

## Caveats/Weaknesses with GSM

- constrained to 2G
- There are open source 3G projects (as of 2013)
    - These have investigations into security and what not

## GSM’s Dominance (2013)

- Despite 4G rollout, GSM is (as of 2013) the dominant cellular network

### Strengths:

- Most new LTE devices are backwards compatible with GSM
- Dominant in most countries
- More base stations
    - Lower number of UMTS and LTE base stations (probably the same issue with current 5G networks)
- Good for IoT, M2M (machine to machine), and non-voice
    - modern network technologies are not great at these slower speeds
- IMPORTANT TO KNOW IF IT’s SECURE.

# GSM Threats

## The Vulnerabilities

- There are active attacks that cannot be excluded from GSM and other cellulr network threat model
- LTE & UMTS are also vulnerable (2013)
    - the root cause still exists in these too
    - Soft and hardware make it difficult to test these attacks in LTE & UMTS

## Summary of Findings

- Paging Response Attack
    - novel and practical attack against mobile terminated services
- DOS using loaded firmware
    - mobile phone firmware which is capable to steal a
    short message over-the-air and to perform denial of
    service attacks against mobile terminated services
    in GSM networks
- Boundary Conditions for Large-Scale DOS
    - the boundary conditions for a
    large-scale paging response attack in order to cause
    denial of service conditions within a large geographical area of a major city

# 3GPP GSM network infrastructure

## GSM Infrastructure

![Untitled](Let%20Me%20Answer%20That%20For%20You%20Exploiting%20Broadcast%20In/Untitled.png)

- BTS - Base Transceiver Station
    - Access point for the phone
    - A set of BTSs is controlled by a Base Station Controller (BSC) which is a part of a Base Station System (BSS)
- MS - Mobile Station
    - phone
    - mobile device interacting with the mobile operator network
    - PARTS:
        - baseband processor
        - SIM cards
        - GSM stack implementation
    - MS interacts with the BTS over radio (Um)
    - Synonyms - mobile device, user, subscriber, phone.
- MSC - Mobile Switching Center
    - routing services - calls, messages
    - utilizes components from the BSS
    - Connects cellular network to the Public Switched Telephone Network (PSTN)
- VLR - Visitor Location Register
    - The Visitor Location Register maintains location and management data for mobile subscribers
    roaming in a specific geographical area handled by
    an MSC
    - Local DB for various MS information.
    - These are obtained from the Home Location Register (HLR)
    - MS can be in only one VLR at a time.
    - Areas served by VLRs have unique IDs

## Types and Functions of Logical Channels

![Untitled](Let%20Me%20Answer%20That%20For%20You%20Exploiting%20Broadcast%20In/Untitled%201.png)

- Available GSM frequencies are shared among mobile carriers.
- Frequency bands are divided into multiple carrier frequencies by means of *Frequency Division Multiple Access (FDMA)*.
- Radio frequencies are shared among users, so they used Time Division Multiple Access (TDMA) to divide physical channels into 8 time slots.

### 2 Categories of Logical Channels

- Control Channels
    - Signaling between the network and the MS
    - 3 Categories of Control Channels:
        - BCH
            - “broadcast channels”
            - point to multipoint
            - Base Station to multiple mobile stations
            - use Downlink Frequency
            - preliminary stages of getting a signal
            - sub channels:
                - BCCH - broadcast
                - FCCH - frequency correction
                - SCH - syncronization
            - Other functions:
                - frequency correction
        - CCCH
            - “Common Control Channels”
            - signaling between BTS and MS
            - use uplink and downlink
            - request to make a call
            - notifies phone
            - temporary mobile subscriber ID
                - helps with preventing tracking
        - DCCH
            - “Dedicated Control Channels”
            - related to handover procedures or connection establishment during call setups
            - authentication selection and call ending and beginning
- Traffic Channels
    - related to the actual traffic

### Attack-Related (CCCH & DCCH)

Common Control Channels and the Dedicated Control Channels consist of several logical channels.

Related logical channels from CCCH & DCCH:

- ***CCCH***
    - PCH - Paging Channel
        - used by BTS to inform MS about an incoming service
        - monitored by any MS in idle mode (unless currently using dedicated channel)
    - RACH - Random Access Channel
        - shared uplink used by MS to request a dedicated channel from the BTS
        - Required for phone calls and incoming services
    - AGCH - Access Grant Channel
        - provides downlink channel used by the BTS to transmit assignment messages to MSs
        - Give MS required configuration parameters to tune to requested channels
- ***DCCH***
    - SDCCH - Standalone Dedicated Control Channel
        - employed for call setup and signaled between BTS and MS
        - can give short messages to the MS

### Point-to-Multipoint Note

- BCH and CCCH channel types are point-to-multipoint
- On the logical downlink channels, all subscribers served by a specific BTS will see the information being broadcasted

## Protocol Details of GSM - Mobile Terminated vs Mobile Originated

- To deliver to a phone MSC needs location of subscriber(MS).
    - 2 reasons
        - MSC doesn’t know best BTS by connection to MS
        - Mobile phones are idle most of the time to save battery and won’t be in contact with network always.
- Basic Procedure:
    1. Core network gets the MSC/VLR for the target subscriber by using the VLR database
    2. MSC obtains the location info for the mobile phone from the VLR and send paging msg to all BSCs in the mobile phone’s area
        1. list of cell id/base stations srving the local area (local area code?)
        2. also has IMSI or TMSI (id for phone)
    3. Rest of procedure below

# Novel Attack with Paging Procedure

![Untitled](Let%20Me%20Answer%20That%20For%20You%20Exploiting%20Broadcast%20In/Untitled%202.png)

## MT Paging Procedure

1. BSC send paging command message
    1. subscriber ID (IMSI)
2. BSC compare the Mobile ID (IMSI or TMSI) 
    1. BSC determines if message addresses itself or another subscriber
3. If ID match
    1. mobile phone needs radio resources inorder to get MT service
    2. sends a channel request
        1. include Random reference number on the uplink RACH
4. Network allocates radio resources and a dedicated channel (usually a call)
    1. Allows the MS to ID its assignment
    2. Message contains random reference number of the requester
5. AGCH - shared downlink channel.  MS receives assignment message
    1. if reference matches, MS turns to dedicated signaling channel
6. MS establishes signaling link (over SDCCH) by sending GSM Layer 2 SABM frame containing Layer 3 paging response message
7. MS and BTS undergo auth, ciphering, and service setup procedure

## The Threat Model

### DOS Attack

- ensure a person or region of devices cannot use GSM properly
- blocks receiving of calls
- bumps up phone billing

### Mobile Terminated Impersonation

- hijack MT service
- hijack SMS message
- prevent SMS message to victim
- obtain 2FA tokens
- hijack a call (voice still would be different)

## Exploit

### Notable Weaknesses in MT Service

- Network State
    - GSM networks have high amounts of traffic
    - Tight radio resources
    - States must be very short
- Broadcast Information
    - Paging is initiated on a broadcast medium
        - PCH portion of the CCCH
        - before any auth or ciphering has taken place
        - Any mobile phone can observe paging request

### DOS (Denial of Service)

- If the adversary phone can answer a paging request faster than the intended phone, then the intended phone will be out of the state (memory) and forgotten.  The service setup on the BSC will not succeed without the auth keys from the phone (MC), so it will sit and wait for a bit.  The call will then be dropped as the victim will receive a channel release message.
- Attack Strengths:
    1. does not rely on frequency jamming
    2. does not rely on resourcer exhaustion
    3. is hard to detect
- Exploitable (2013) on O2, Vodaphone, T-Mobile, and E-Plus

### MT Hijacking

- Answer the paging request faster than the victim phone
- Break the authentication or happen to be a case where authentication isn’t used
    - only undeer 20% of networks by gsmmap authenticate mobile terminated phone calls 100% of the time
    - 50% only authenticate 10% of the time
- Even with A5 encryption, the attacker can just crack the session key and send a “cipher mode complete” message. The cracked session key can decrypt subsequent communication that follows the cipher setup.
    - use kraken to greb these session keys
    - A5/2 and A5/1 are cryptographically weak

## LTE & UMTS

- LTE uses the same paging procedure which brings up the same issues
- bad cryptography escalates the issue for hijacking threats

## Hacking Hardware

- Radio devices
    - USRP
    - Vitelcom TSM30
        - not easy to get
    - TI Calypso chipset based phones
- ex:
    - motorola C123, Motorola C118
    - can be used with OsmocomBB
    - receive over the air traffic and send GSM frames

## Implementation / POC

- OsmocomBB
- Motorola C1XX phones with custom OsmocomBB firmware
- GPS Receivers
- Laptop for serial communication

## Feasibility

- Depends on response time of attacker and victim device
    - Factors:
        - MAJOR: baseband chipset, GSM stack implementation
        - MINOR: weather, network saturation, application processor OS, GSM time slots, and others
    - Timing can be measured programmatically by simulating it in Open BTS

# Conditions for Large-Scale DOS with Paging Procedure Attack

- Ideal conditions get to around 64.8 paging requests per minute
- A single attacker phone is almost always not enough for this
- Multiple phones could do some damage
- DOSing a whole area depends on the paging activity

## Location Area Paging Activity

- modified OsmocomBB to log all TMSIs with timestamps
- anomalies with paging requests
    - M2M / remote monitoring devices
    - some networks double up paging requests like Vodafone

## Mapping Location Areas

- location areas aren’t all the same size
- LAC - Location Area Code is broadcasted by each BTS
- use cell-log from OsmocomBB
    - scans ARFCNs in the assigned GSM frequency spectrum for a carrier signal
    - decodes system info messages as broadcasted on the BCCH
    - determine the geo location of the observed LAC
- drive slow through city with multple OsmocomBB devices

## Amplify the DOS Attack (Large-Scale)

- IMSI DETACH message is not authenticated in GSM and 3G
- Indicates to the network that a victim is no longer available to a network
    - user will have to reconnect or reboot
- TMSIs can also be used here

### Feasibility

- A single cell can provide enough to attack a complete location area of a small provider
- Resources are shared with legit MO and MT traffic
- Combination with IMSI detach can prevent all phones from further communciation till rebooting the network on the phone settings

# Countermeasures

## Change the Paging Protocol Procedure

- the paging response is not authenticated
- authentication is performed after the paging response is processed
- Same principle with UMTS
- Paging response that includes auth info can be used to validate the response before deleting the caller from state/memory.  This would also solve the denial of service attack problem
- This requires a fresh RAND for every authentication to prevent replay attacks
    - similar to protocol change proposed by Arapnis with the “unlikability” key

## Address Exploits Individually

### MT Session Hijacking

- enforce authentication for each service request

### Change the MSC/VLR state machine

- map all incoming paging responses to the correct service as long as no fully authenticated session exists

# Related Research

## Impersonation Exploits

- Nohl and Melette demonstrate that you can impersonate a phone for mobile originated services
- You can place a phone call as a victim by:
    - sniffing transaction over-the-air
    - cracking the session key
    - knowing victim’s TMSI
- Exploit:
    - replay authentication challenges to the victim
    - send SMS message on behalf of the subscriber

## DOS Exploits

- Things that affect MT services of subscribers
- 3 types of DOS:
    - targeting the victim phone
    - focusing on the network
    - attacks affecting subscribers of a network

### DOS on victim phones

- usually baseband specific and caused by implementation flaws
- Curse-of-Silence flaw
    - nokia devices
- (Racic et al) You can send crafted MMS messages to a victim to exhaust their battery quickly
- MOST OF THESE ARE DEPENDENT ON DEVICE TYPE

### DOS on the operator

- design flaws
- (Spaar) exhaust channel resources of BTS by requesting new channels on RACH
    - limited to single BTS
- (Enck et al) deny voice or SMS within geographic area by sending a large number of short messages to subscribers in that area
- (Serror et al) CDMA2000 network overload through large paging load and delay of paging messages via Internet orignating packages to phones
- (Lee et al) 3G/WiMax resource consumption attack
- (Traynor) degrade performance of phone network with a phone botnet by repeatedly changing call forwarding settings

# Conclusion

- Attacks against mobile terminated services are a minority despite the prevalence of weaknesses
- Open sourced projects have made it possible to utilize these threats via a number of exploits
- Exploited the trust in the paging protocol on a broadcast medium